<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Terminal Codes — Demo</title>
<style>
:root {
  --bg: #000; --text: #0f0; --muted: #3a3; --panel: #061;
  --font: 'Courier New', monospace;
}
html, body {height:100%; margin:0; background:var(--bg); color:var(--text); font-family:var(--font);}
.app{display:flex; flex-direction:column; height:100vh; padding:16px; box-sizing:border-box;}
.header{display:flex; align-items:center; gap:12px;}
.logo{font-weight:700; font-size:18px;}
.panel{flex:1; display:flex; gap:12px; margin-top:12px;}
.terminal{flex:1; background:#010201; border-radius:8px; padding:12px; box-shadow:0 8px 24px rgba(0,0,0,.6); display:flex; flex-direction:column;}
.log{flex:1; overflow:auto; padding:6px; border-radius:6px; background:linear-gradient(180deg,#001000 0,#001400 100%);}
.log p{margin:6px 0; line-height:1.35;}
.input-row{display:flex; gap:8px; margin-top:8px;}
.cmd{flex:1; background:transparent; border:1px solid #083; outline:none; padding:10px; color:var(--text); font-family:var(--font); font-size:14px; border-radius:6px;}
.btn{background:#063; border:0; padding:10px 12px; border-radius:6px; color:var(--text); cursor:pointer;}
.side{width:320px; background:#020402; border-radius:8px; padding:12px;}
.stat{font-size:14px; margin-bottom:8px;}
.small{color:var(--muted); font-size:13px;}
.cursor{display:inline-block; width:10px; animation:blink 1s steps(2) infinite; margin-left:4px;}
@keyframes blink{50%{opacity:0}}
.admin-badge{background:#113311; padding:4px 8px; border-radius:6px; font-size:12px;}
.hint{background:#001500; padding:8px; border-radius:6px; font-size:13px;}
.danger{color:#f33;}
footer{margin-top:12px; color:var(--muted); font-size:12px;}
@media (max-width:900px){.panel{flex-direction:column}.side{width:100%}}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="logo">TERMINAL CODES</div>
    <div class="small">Zadej kód → získej odměnu</div>
    <div style="margin-left:auto" class="admin-badge" id="adminBadge">USER</div>
  </div>

  <div class="panel">
    <div class="terminal">
      <div id="log" class="log"></div>
      <div class="input-row">
        <input id="cmdInput" class="cmd" placeholder="zadej kód nebo příkaz (HELP pro nápovědu)" autocomplete="off" />
        <button id="sendBtn" class="btn">OK</button>
      </div>
    </div>

    <div class="side">
      <div class="stat">Body: <strong id="points">0</strong></div>
      <div class="stat">Použité kódy: <span id="usedCount">0</span></div>
      <div class="hint" style="margin-bottom:8px">Příkazy: <code>HELP</code>, <code>RESET</code>, <code>MYCODES</code>, <code>ADMIN ADD &lt;KOD&gt; &lt;TYPE&gt; &lt;VALUE&gt;</code></div>
      <div class="small">Admin příklad: <code>ADMIN ADD SECRET1 points 100</code></div>
      <hr style="border:1px solid #022;margin:10px 0" />
      <div class="small">LocalStorage klíče: <code>tc_player</code>, <code>tc_codes</code></div>
      <footer>Verze: 0.2 — demo</footer>
    </div>
  </div>
</div>

<script>
// ====== Utils ======
const el=id=>document.getElementById(id);
const logEl=el('log'), input=el('cmdInput'), sendBtn=el('sendBtn'), pointsEl=el('points'), usedCountEl=el('usedCount'), adminBadge=el('adminBadge');

function beep(volume=0.05,freq=800,duration=0.06){
  try{
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const o=ctx.createOscillator(); const g=ctx.createGain();
    o.type='sine'; o.frequency.value=freq; g.gain.value=volume;
    o.connect(g); g.connect(ctx.destination);
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + duration);
    setTimeout(()=>{o.stop(); ctx.close();}, duration*1000+50);
  }catch(e){}
}

// ====== LocalStorage ======
const SK_PLAYER='tc_player', SK_CODES='tc_codes';
const DEFAULT_PLAYER={points:0, usedCodes:[], isAdmin:false};
let player=JSON.parse(localStorage.getItem(SK_PLAYER) || JSON.stringify(DEFAULT_PLAYER));

let codes=JSON.parse(localStorage.getItem(SK_CODES) || '{}');

function savePlayer(){ localStorage.setItem(SK_PLAYER, JSON.stringify(player)); }
function saveCodes(){ localStorage.setItem(SK_CODES, JSON.stringify(codes)); }

// ====== UI helpers ======
function appendLog(text, opts={html:false,className:null}){
  const p=document.createElement('p');
  if(opts.html) p.innerHTML=text; else p.textContent=text;
  if(opts.className) p.className=opts.className;
  logEl.appendChild(p);
  logEl.scrollTop=logEl.scrollHeight;
}

function renderStatus(){
  pointsEl.textContent=player.points;
  usedCountEl.textContent=player.usedCodes.length;
  adminBadge.textContent=player.isAdmin ? 'ADMIN' : 'USER';
}

// ====== Seed codes ======
function seedCodes(){
  const defaultCodes={
    'WELCOME': {rewardType:'points', value:50, message:'Vítej! Získal jsi 50 bodů.'},
    'SECRET1': {rewardType:'text', value:'Nápověda: Papírek je pod lavičkou.'},
    'Kod1': {rewardType:'points', value:10, message:'Získal jsi 10 bod.'},
    'BONUS': {rewardType:'points', value:25, message:'BONUS! 25 bodů.'},
    '8B': {rewardType:'text', value:'Gratulace! Nalezl jsi tajnou zprávu.'},
    'Used': {rewardType:'points', value:5, message:'5 bodů za použitý kód.'},
    'END': {rewardType:'endgame', message:'Zadej passcode pro ukončení hry: 1404'}
  };
  for(const c in defaultCodes){ if(!codes[c]) codes[c]=defaultCodes[c]; }
  saveCodes();
}

seedCodes();

// ====== Core ======
appendLog('Vítej v Terminal Codes. Napiš HELP pro nápovědu.');
renderStatus();

function processLine(raw){
  const line=raw.trim(); if(!line) return;
  appendLog('> '+line);

  const parts=line.split(/\s+/);
  const cmd=parts[0].toUpperCase();

  if(cmd==='HELP'){ appendLog('Příkazy: HELP, RESET, MYCODES, ADMIN ADD <KOD> <TYPE> <VALUE>'); return; }
  if(cmd==='RESET'){ localStorage.removeItem(SK_PLAYER); player={...DEFAULT_PLAYER}; savePlayer(); appendLog('Local data smazána.'); renderStatus(); return; }
  if(cmd==='MYCODES'){ appendLog('Použité kódy: '+(player.usedCodes.length?player.usedCodes.join(', '):'(žádné)')); return; }

  // ADMIN ADD
  if(cmd==='ADMIN' && parts[1]?.toUpperCase()==='ADD'){
    if(!player.isAdmin){ appendLog('Přístup odepřen.'); return; }
    if(parts.length<5){ appendLog('Chybný formát. ADMIN ADD <KOD> <TYPE> <VALUE>'); return; }
    const code=parts[2], type=parts[3], value=parts.slice(4).join(' ');
    codes[code]={rewardType:type, value:value, message:'Nový kód vytvořen: '+code};
    saveCodes(); appendLog(`Kód ${code} přidán (type=${type}, value=${value}).`);
    return;
  }

  // Special admin unlock
  if(line==='Filip'){ player.isAdmin=true; savePlayer(); renderStatus(); appendLog('ADMIN panel odemčen.'); return; }

  // Check codes
  checkCode(line);
}

function checkCode(code){
  if(player.usedCodes.includes(code)){ appendLog('Tento kód už byl použit.'); beep(0.04,600,0.04); return; }
  if(!codes[code]){ appendLog('Kód neexistuje.'); beep(0.03,300,0.06); return; }

  const info=codes[code];
  player.usedCodes.push(code); savePlayer();

  if(info.rewardType==='points'){ const pts=Number(info.value)||0; player.points+=pts; savePlayer(); appendLog(`OK — získal jsi ${pts} bodů. ${info.message||''}`); beep(0.08,900,0.12); }
  else if(info.rewardType==='text'){ appendLog(info.value||info.message||'Dostal jsi textovou odměnu.'); beep(0.06,700,0.09); }
  else if(info.rewardType==='sound'){ appendLog(info.message||'Přehrávám zvuk...'); try{ const a=new Audio(info.value); a.play(); }catch(e){ appendLog('Nepodařilo se přehrát zvuk.');} }
  else if(info.rewardType==='endgame'){
    appendLog(info.message||'END GAME.'); 
    let pass=prompt('Zadej passcode:');
    if(pass==='1404'){ appendLog('Hra ukončena. Děkujeme za hraní!'); } 
    else{ appendLog('Špatný passcode.'); }
  }
  renderStatus();
}

// ====== UI hooks ======
sendBtn.addEventListener('click', ()=>{ processLine(input.value); input.value=''; input.focus(); });
input.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ processLine(input.value); input.value=''; } });
adminBadge.addEventListener('dblclick', ()=>{ player.isAdmin=!player.isAdmin; savePlayer(); renderStatus(); appendLog('ADMIN mode: '+(player.isAdmin?'ON':'OFF')); });

</script>
</body>
</html>
