<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Terminal Codes — Magikánova Temnota</title>
<style>
:root {
  --bg:#000; --text:#0f0; --muted:#3a3; --panel:#061;
  --font: 'Courier New', monospace;
}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:var(--font);}
.app{display:flex;flex-direction:column;height:100vh;padding:16px;box-sizing:border-box;}
.header{display:flex;align-items:center;gap:12px;}
.logo{font-weight:700;font-size:18px;}
.panel{flex:1;display:flex;gap:12px;margin-top:12px;}
.terminal{flex:1;background:#010201;border-radius:8px;padding:12px;box-shadow:0 8px 24px rgba(0,0,0,.6);display:flex;flex-direction:column;}
.log{flex:1;overflow:auto;padding:10px;border-radius:6px;background:linear-gradient(180deg,#001000 0,#001400 100%)}
.log p{margin:6px 0;line-height:1.45}
.input-row{display:flex;gap:8px;margin-top:8px}
.cmd{flex:1;background:transparent;border:1px solid #083;outline:none;padding:10px;color:var(--text);font-family:var(--font);font-size:14px;border-radius:6px}
.btn{background:#063;border:0;padding:10px 12px;border-radius:6px;color:var(--text);cursor:pointer}
.side{width:320px;background:#020402;border-radius:8px;padding:12px}
.stat{font-size:14px;margin-bottom:8px}
.small{color:var(--muted);font-size:13px}
.cursor{display:inline-block;width:10px;animation:blink 1s steps(2) infinite;margin-left:4px}
@keyframes blink{50%{opacity:0}}
.admin-badge{background:#113311;padding:4px 8px;border-radius:6px;font-size:12px;cursor:pointer}
.hint{background:#001500;padding:8px;border-radius:6px;font-size:13px}
.danger{color:#f33}
footer{margin-top:12px;color:var(--muted);font-size:12px}
@media(max-width:900px){.panel{flex-direction:column}.side{width:100%}}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);justify-content:center;align-items:center;z-index:999;}
.modal-content{background:#010201;padding:20px;border-radius:8px;width:90%;max-width:700px;color:#0f0;position:relative;}
.modal-content h2{margin-top:0;}
.close-modal{position:absolute;top:10px;right:10px;cursor:pointer;color:#f33;font-weight:bold;}
input, select{background:#001100;color:#0f0;border:1px solid #083;padding:6px;margin:4px 0;border-radius:4px;width:100%;}
button{margin-top:6px;}
table{width:100%;border-collapse:collapse;margin-top:8px;}
th,td{border:1px solid #033;padding:4px;text-align:left;}
.code-value{white-space:pre-wrap;color:#bdf;}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="logo">TERMINAL CODES</div>
    <div class="small">Zadej kód → odměna</div>
    <div style="margin-left:auto" class="admin-badge" id="adminBadge">USER</div>
  </div>

  <div class="panel">
    <div class="terminal">
      <div id="log" class="log"></div>
      <div class="input-row">
        <input id="cmdInput" class="cmd" placeholder="zadej kód nebo příkaz (HELP)" autocomplete="off"/>
        <button id="sendBtn" class="btn">OK</button>
      </div>
    </div>

    <div class="side">
      <div class="stat">Body: <strong id="points">0</strong></div>
      <div class="stat">Použité kódy: <span id="usedCount">0</span></div>
      <div class="hint">HELP, RESET, MYCODES</div>
      <footer>Verze 0.7 — Strašidelné zprávy</footer>
    </div>
  </div>
</div>

<!-- Admin Modal -->
<div class="modal" id="adminModal">
  <div class="modal-content">
    <span class="close-modal" id="closeAdmin">&times;</span>
    <h2>Admin Panel</h2>

    <h3>Create Code</h3>
    <input id="newCode" placeholder="Code">
    <select id="newType">
      <option value="points">points</option>
      <option value="text">text</option>
      <option value="sound">sound</option>
      <option value="endgame">endgame</option>
    </select>
    <input id="newValue" placeholder="Value / message">
    <button id="addCodeBtn">Add Code</button>

    <h3>Existing Codes</h3>
    <table id="codesTable">
      <thead><tr><th>Code</th><th>Type</th><th>Value</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3>Players</h3>
    <table id="playersTable">
      <thead>
        <tr>
          <th>Player</th>
          <th>Points</th>
          <th>Used Codes</th>
          <th>Location</th>
          <th>Role</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
const el=id=>document.getElementById(id);
const logEl=el('log'), input=el('cmdInput'), sendBtn=el('sendBtn'), pointsEl=el('points'), usedCountEl=el('usedCount'), adminBadge=el('adminBadge');
const modal=el('adminModal'), closeModal=el('closeAdmin');
const newCodeInput=el('newCode'), newType=el('newType'), newValue=el('newValue'), addCodeBtn=el('addCodeBtn');
const codesTableBody=el('codesTable').querySelector('tbody');
const playersTableBody=el('playersTable').querySelector('tbody');

function beep(vol=0.05,freq=800,dur=0.06){
  try{ const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(); const g=ctx.createGain(); o.type='sine'; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(ctx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+dur); setTimeout(()=>{o.stop();ctx.close();},dur*1000+50);}catch(e){}
}

const SK_PLAYER='tc_player', SK_CODES='tc_codes';
let player=JSON.parse(localStorage.getItem(SK_PLAYER)||JSON.stringify({points:0,usedCodes:[],isAdmin:false}));
let codes=JSON.parse(localStorage.getItem(SK_CODES)||'{}');

function savePlayer(){ localStorage.setItem(SK_PLAYER, JSON.stringify(player)); }
function saveCodes(){ localStorage.setItem(SK_CODES, JSON.stringify(codes)); }

// Strašidelné příběhy magikána
const MAGIKAN_MESSAGES={
  '8B':`Magikán zmizel uprostřed noci, když jeho laboratoř plná světel zhasla. 
Jeho rukopis zůstal, ale hlas se už nikdy neozval. V prázdném sále cinkaly staré hodiny a stíny se slily do tmavého kouta.`,
  'SECRET1':`Když otevřeš tuto stránku, pocítíš chlad jeho přítomnosti. 
Magikán kráčel mezi dveřmi, kde světlo nebylo dovoleno, a každý, kdo jej sledoval, zaslechl jen šepot dávných kleteb.`
};

// Seed default codes
function seedCodes(){
  const defaultCodes={
    'Kod1':{rewardType:'points',value:10,message:'10 bodů'},
    'BONUS':{rewardType:'points',value:25,message:'BONUS 25 bodů'},
    '8B':{rewardType:'text',value:MAGIKAN_MESSAGES['8B'],message:'Tajemství magikána'},
    'SECRET1':{rewardType:'text',value:MAGIKAN_MESSAGES['SECRET1'],message:'Strašidelný vzkaz magikána'},
    'Used':{rewardType:'points',value:5,message:'5 bodů'},
    'END':{rewardType:'endgame',message:'Zadej passcode 1404'}
  };
  for(const c in defaultCodes) if(!codes[c]) codes[c]=defaultCodes[c];
  saveCodes();
}
seedCodes();

function appendLog(msg, opts={}){ const p=document.createElement('p'); if(opts.html)p.innerHTML=msg; else p.textContent=msg; if(opts.class)p.className=opts.class; logEl.appendChild(p); logEl.scrollTop=logEl.scrollHeight; }
function renderStatus(){ pointsEl.textContent=player.points; usedCountEl.textContent=player.usedCodes.length; adminBadge.textContent=player.isAdmin?'ADMIN':'USER'; }
appendLog('Vítej v Terminal Codes. Napiš HELP pro nápovědu.');
renderStatus();

function processLine(line){
  const raw=line.trim(); if(!raw) return; appendLog('> '+raw);
  const parts=raw.split(/\s+/), cmd=parts[0].toUpperCase();

  if(cmd==='HELP'){ appendLog('HELP, RESET, MYCODES'); return; }
  if(cmd==='RESET'){ localStorage.removeItem(SK_PLAYER); player={points:0,usedCodes:[],isAdmin:false}; savePlayer(); renderStatus(); appendLog('Data smazána.'); return; }
  if(cmd==='MYCODES'){ appendLog('Použité kódy: '+(player.usedCodes.length?player.usedCodes.join(', '):'(žádné)')); return; }

  if(raw==='Filip'){ player.isAdmin=true; savePlayer(); renderStatus(); openAdmin(); return; }
  if(raw==='Orsag'){ player.isAdmin=false; savePlayer(); renderStatus(); appendLog('Admin status zrušen. Jsi USER.'); closeAdminModal(); return; }

  checkCode(raw);
}

function checkCode(code){
  if(code==='Orsag'){ player.isAdmin=false; savePlayer(); renderStatus(); appendLog('Admin status zrušen. Jsi USER.'); closeAdminModal(); return; }
  if(player.usedCodes.includes(code)){ appendLog('Tento kód už byl použit.'); beep(); return; }
  if(!codes[code]){ appendLog('Kód neexistuje.'); beep(0.03,300,0.06); return; }

  const info=codes[code];
  player.usedCodes.push(code); savePlayer();

  if(info.rewardType==='points'){ const pts=Number(info.value)||0; player.points+=pts; savePlayer(); appendLog(`OK — ${pts} bodů. ${info.message||''}`); beep(0.08,900,0.12);}
  else if(info.rewardType==='text'){ appendLog('--- Magikánův vzkaz ---'); appendLog(info.value,{class:'code-value'}); appendLog('--- konec vzkazu ---'); beep(); }
  else if(info.rewardType==='sound'){ appendLog(info.message||'Přehrávám zvuk'); try{ new Audio(info.value).play(); }catch(e){ appendLog('Nepodařilo se přehrát zvuk.');} }
  else if(info.rewardType==='endgame'){ const pass=prompt('Zadej passcode:'); if(pass==='1404'){ appendLog('Hra ukončena. Děkujeme!'); } else appendLog('Špatný passcode');}

  renderStatus();
}

// Admin modal
function openAdmin(){ modal.style.display='flex'; renderAdminTables(); }
function closeAdminModal(){ modal.style.display='none'; }
closeModal.addEventListener('click', closeAdminModal);
window.addEventListener('click',e=>{ if(e.target===modal) closeAdminModal(); });

function renderAdminTables(){
  codesTableBody.innerHTML='';
  for(const c in codes){
    const tr=document.createElement('tr');
    const val=(codes[c].rewardType==='text'?`<pre class="code-value">${codes[c].value||''}</pre>`:(codes[c].value||''));
    tr.innerHTML=`<td>${c}</td><td>${codes[c].rewardType}</td><td>${val}</td>
      <td><button onclick="deleteCode('${c}')">Remove</button></td>`;
    codesTableBody.appendChild(tr);
  }

  playersTableBody.innerHTML='';
  const p={name:'Player',points:player.points,usedCodes:player.usedCodes,location:player.location||'N/A',isAdmin:player.isAdmin};
  const tr=document.createElement('tr');
  tr.innerHTML=`<td>${p.name}</td><td>${p.points}</td><td>${p.usedCodes.join(', ')}</td><td>${p.location}</td><td>${p.isAdmin?'ADMIN':'USER'}</td><td><button onclick="toggleRole()">Change Role</button></td>`;
  playersTableBody.appendChild(tr);
}

function deleteCode(code){ if(confirm('Chceš opravdu smazat kód "'+code+'"?')){ delete codes[code]; saveCodes(); renderAdminTables(); appendLog('Kód '+code+' smazán.'); } }
function toggleRole(){ player.isAdmin=!player.isAdmin; savePlayer(); renderStatus(); renderAdminTables(); appendLog('Role hráče změněna na: '+(player.isAdmin?'ADMIN':'USER')); }

addCodeBtn.addEventListener('click',()=>{
  const c=newCodeInput.value.trim(); if(!c){ alert('Zadej název kódu'); return; }
  codes[c]={rewardType:newType.value,value:newValue.value,message:newValue.value};
  saveCodes(); newCodeInput.value=''; newValue.value=''; renderAdminTables(); appendLog('Kód '+c+' přidán.'); 
});

sendBtn.addEventListener('click',()=>{ processLine(input.value); input.value=''; input.focus(); });
input.addEventListener('keydown',e=>{ if(e.key==='Enter'){ processLine(input.value); input.value=''; } });

</script>
</body>
</html>
